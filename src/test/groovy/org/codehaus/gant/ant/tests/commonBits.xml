<?xml version="1.0" encoding="UTF-8"?>

<!--
   Gant - A Groovy way of scripting Ant tasks.

   Copyright Â© 2009-10 Russel Winder

   Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except in
   compliance with the License. You may obtain a copy of the License at

   http://www.apache.org/licenses/LICENSE-2.0

   Unless required by applicable law or agreed to in writing, software distributed under the License is
   distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or
   implied. See the License for the specific language governing permissions and limitations under the
   License.
  
   Author : Russel Winder <russel.winder@concertant.com>
-->

<project name="Common Ant File Bits for Gant Ant Task Test" xmlns:artifact="urn:maven-artifact-ant" basedir="." >

  <property file="build.properties"/>

  <property environment="environment"/>

  <property name="targetDirectory" value="${toplevelDirectory}/target_gant"/>
  <property name="gantClassesDirectory" value="${targetDirectory}/classes"/>
  
  <target name="-initialize">
    <path id="mavenAntTaskJarPathId">
      <fileset dir="${toplevelDirectory}/jarfiles" includes="maven-ant-tasks-*.jar"/>
    </path>
    <typedef resource="org/apache/maven/artifact/ant/antlib.xml" uri="urn:maven-artifact-ant" classpathref="mavenAntTaskJarPathId"/>
    <property environment="environment"/>
    <artifact:dependencies pathId="groovyJarsId">
      <dependency groupId="org.codehaus.groovy" artifactId="groovy-all" version="${environment.GROOVY_ANT_TASK_TEST_VERSION}"/>
    </artifact:dependencies>
  </target>

  <target name="-defineGroovyTask" depends="-initialize">
    <taskdef name="groovy" classname="org.codehaus.groovy.ant.Groovy" classpathref="groovyJarsId" />
  </target>

  <!--
      The executing Gant script needs to be able to access the Gant_Test class in order to return the value
      tested.  This target can only complete successfully if the classes are put on the class path by giving
      a parameter to the Ant invocation.  So for example:

          ant -f gantTest.xml -lib ../../../../../../../../target_gant/test-classes:$GROOVY_HOME/lib/junit-4.7.jar

      note that the JUnit jar has to be added as well.
  -->

  <target name="-defineGantTask" depends="-initialize">
    <taskdef name="gant" classname="org.codehaus.gant.ant.Gant">
      <classpath>
        <pathelement location="${gantClassesDirectory}"/>
        <path refid="groovyJarsId"/>
      </classpath>
    </taskdef>
  </target>
  
</project>
